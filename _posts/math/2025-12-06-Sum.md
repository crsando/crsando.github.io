---
layout: post 
title: 一道综合高斯函数的数列求和问题
tags: math,education,geometry
category: math
---

*Source:原题来自“一课一练”的数列部分，原始出处不明*

#### 1

设数列 $a_n = \min \left\{ k + \frac{n}{4k} \mid k \in \mathbb{N^*} \right\}$，定义“优数列”：$\Delta a_n = a_n - \lfloor a_n \rfloor (n = 1, 2, \ldots)$，其中 $\lfloor x \rfloor$ 表示不超过 $x$ 的最大整数。设 $S_n = \Delta a_1 + \Delta a_2 + \ldots + \Delta a_n$ 为优数列的前 $n$ 项和，试求 $S_{2024}$ 的值。

***Solution***

（为简化叙述，本文中一些等价关系直接用$\implies$表示，请读者自行判断哪里是单纯的推出哪里其实是等价）

这题我们先转化一下，所谓$\Delta a_1$无非是求$a_1$的小数部分，因此本解答采用惯用的写法是$\{a_1\} = a_1 - \lfloor a_1 \rfloor = \Delta a_1$。

**第一部分**，先解$a_n$，即考虑$a_n$和$k$的对应关系。

对固定的$n$，考虑函数$f(x) = x + \frac{n}{4x}$，这个函数显然在$x > 0$上是先减后增的，我们考虑不等式（$k \in N$）

$$
\begin{aligned}
    & f(k) \leqslant f(k-1)  \\
    \implies & k + \frac{n}{4k} \leqslant k - 1 + \frac{n}{4(k-1)} \\
    \implies & 1  \leqslant \frac{n}{4(k-1)} - \frac{n}{4k} \\
    \implies & 4k(k-1)  \leqslant n  \\
    \implies & (2k-1)^2 \leqslant n + 1 \\
    \implies & k \leqslant \frac{\sqrt{n+1} + 1}{2}
\end{aligned}
$$

故

$$
\begin{aligned}
    \min_{k\in Z^+} f(k) = f(\lfloor \frac{\sqrt{n+1} + 1}{2} \rfloor)
\end{aligned}
$$

故我们可以取

$$
    k_n = \lfloor \frac{\sqrt{n+1} + 1}{2} \rfloor
$$

则成立

$$
\begin{aligned}
    a_n &= k_n + \frac{n}{4k_n} \\
    \{a_n\} &= \frac{n}{4k_n} - \lfloor \frac{n}{4k_n}\rfloor \\
\end{aligned}
$$

**第二部分**，我们考虑这里的高斯函数如何去掉，即如何计算$\lfloor \frac{n}{4k_n} \rfloor$


我们现在考虑一下$k_n$，注意到

$$
\begin{aligned}
    & k_n \leqslant \frac{\sqrt{n+1} + 1}{2} < k_n + 1 \\
    \implies & (2k_n-1)^2 \leqslant n+1 < (2k_n + 1)^2 \\
    \implies & 4k_n(k_n-1) \leqslant n < 4k_n(k_n + 1) \\
    \implies & k_n-1 \leqslant \frac{n}{4k_n} < k_n + 1 \\
\end{aligned}
$$

所以$\lfloor \frac{n}{4k_n} \rfloor$有两种可能值：$k_n - 1$或者$k_n$，所以我们还是需要分类讨论，更具体的，实际上就是分段求和。

我们现在考虑所有的满足$k_n = k$的$a_n$，此时$4(k-1)k \leqslant n < 4k(k+1)$，容易发现，若$n < 4k^2$，则$\lfloor \frac{n}{4k} \rfloor = k-1$。否则，若$4k \leqslant \frac{n}{4k} < 4k(k+1)$，则$\lfloor \frac{n}{4k} \rfloor = k$

**第三部分**，我们考虑对应固定同一个$k$的所有$\{a_n\}$的和。这背后的逻辑是：由于直接求和$\sum \{a_n\}$比较困难，可以把$a_n$写成一段一段的，每一段（同一段的$a_n$对应相同的$k$。故比较容易求和），然后每段先求和$\sum \{a_n\}$，再加总。

考虑所有对应同一个$k$的所有$\{a_n\}$优数列的和。由前面的分析，可知对应$k$的所有$a_n$为满足$4k(k-1) \leqslant n < 4k(k+1)$的$n$所决定，为方便，记

$$
\begin{aligned}
    S(k) &= \sum_{4k(k-1) \leqslant n < 4(k+1)k} \{a_n\} \\
        &= \sum_{4k(k-1) \leqslant n < 4(k+1)k} \big(\frac{n}{4k} - \lfloor \frac{n}{4k} \rfloor \big) \\
        &= \sum_{4k(k-1) \leqslant n < 4(k+1)k} \frac{n}{4k}  \\
            & \qquad - \sum_{4k(k-1) \leqslant n < 4(k+1)k} \lfloor \frac{n}{4k} \rfloor \\
        &= \sum_{4k(k-1) \leqslant n < 4(k+1)k} \frac{n}{4k}  \\
            & \qquad - \sum_{4k(k-1) \leqslant n < 4k^2} \lfloor \frac{n}{4k} \rfloor \\
            &\qquad  - \sum_{4k^2 \leqslant n < 4k(k+1)} \lfloor \frac{n}{4k} \rfloor \\
        &= \frac{1}{4k} \sum_{4k(k-1) \leqslant n < 4(k+1)k} n  \\
            & \qquad - \sum_{4k(k-1) \leqslant n < 4k^2} (k-1) \\
            &\qquad  - \sum_{4k^2 \leqslant n < 4k(k+1)} k \\
        &= \frac{1}{4k} \cdot \frac{1}{2} \cdot (8k^2 -1) \cdot (8k)  \\
            & \qquad - 4k \cdot (k-1) \\
            &\qquad  - 4k \cdot k \\
        &= (8k^2 -1) - 4k \cdot (2k-1) \\
        &= 4k - 1
\end{aligned}
$$

注意上面的求和符号拆分。

**第四部分**，最终汇总求和。

本题求$S_{2024}$，注意到$2024 = 4 \cdot 22 \cdot 23$，故

$$
\begin{aligned}
    & \{1 \leqslant n \leqslant 2024 \mid n \in Z\}  \\
    =& \Big( \bigcup_{k=1}^{22}\{
            4(k-1)k \leqslant n < 4k(k+1) \mid n \in Z
        \} \Big) \cup \{2024\}
\end{aligned}
$$

上式的含义是我们把$1,2,\cdots,2024$可以切成$22$段再余一个$2024$单独这个数，所以对应求和可以写成

$$
\begin{aligned}
    S_{2024} &= \sum_{k=1}^{22} S(k) + \{a_{2024}\} \\
        &= \sum_{k=1}^{22} (4k-1) + \Big( \frac{2024}{4 \cdot 23}  - \lfloor \frac{2024}{4 \cdot 23} \rfloor \Big) \\
        &= \frac{1}{2} \cdot 22 \cdot (3 + 87) \\
        &= 22 \cdot 45 \\
        &= 990
\end{aligned}
$$