---
layout: post
title: 开始折腾家庭网络和软路由
tags: life,network,home
category: posts
---

从辞职回家后就一直琢磨怎么升级一下家庭的网络，主要是这么几个出发点
- 旧的netgear的路由有点老了，经常不稳定，而且还是Wifi 5的，其实手上的电脑基本都支持Wifi 6了. 正好有台在无锡买的ZTE AX5400 Pro.
- 家庭设备多了以后，怎么科学上网是一个问题。之前设备少，每台设备用Clash/ShadowRocket。现在想用软路由直接解决。

# 计划的网络拓扑结构

目前用的netgear的路由不想动它，毕竟怕影响太坏，等全部切换后再拿掉。

实际切换比较麻烦的就是一个NAS，因为家里的电视也要接入这个，需要samba重新绑定一下。

新的结构计划是：光猫-> Main Router (ZTE AX5400 Pro), with WIFI -> Soft Router + ... + ... +... 

软路由作为旁路由，设备根据需要，设置主路由的静态IP绑定的方式同时指定网关：需要科学上网的设备指定网关到旁路由上，不需要的直接主路由。

# About ZTE AX5400 Pro
没啥好说的，当时没怎么思考。实际安装用了之后感觉配置还是挺方便的，速度很快，而且可以通过静态IP绑定的方式来指定网关。

测试了一下速度，确实Wifi 6性能好多了啊。真舒服。希望后续稳定性给力一点。

# 临时方案

用买的二手Macbook Pro当作临时的旁路由玩一下，方法是参考：https://bulianglin.com/archives/router.html

这位的youtube视频感觉非常给力。

# Soft Router: R4S

万能的淘宝下单了Friendly R4S。感觉R2S/R4S还是玩的人多，保险一点。我的软路由就是用来翻墙，不想搞All-in-One，没有别的需求。

但是OpenClash感觉还是需要一点性能的，怕性能不够，所以没敢选择R2S。反正也就贵200块钱，期货赚回来就好！

固件我在github上找了一个看起来比较轻量的：[stupidloud/nanopi-openwrt](https://github.com/stupidloud/nanopi-openwrt)

烧录不难，我直接用rufus。主要是配置繁琐一点。

    1. 烧录固件，插卡，接电源开机
    2. 用lan口连接电脑（感谢我的ThinkBook 14+，带网口真的舒服）
    3. 此时因为默认的系统直接配置了dhcp服务，默认是192.168.2.1的网关，打开进入openwrt的配置页面。
    4. 修改Openwrt的配置，此时先不弄OpenClash，我先改成静态IP（接入我即将放入的家庭网络，192.168.5.X的网段），关闭dhcp服务。
    5. 重新将R4S接入家庭网路（Lan口对Lan口，ZTE AX5400 Pro），用另一台电脑测试，登入我分配给这台小机器的地址192.168.5.2，成功进入控制页面
    6. 开始弄OpenClash的配置。这里折腾了一下，好在默认的配置已经OK，一开始以为要更新内核但实际上是不需要的，配置一下订阅就好了。

剩下的配置在ZTE上，我还是用主路由的dhcp服务，这样所有的家庭终端，根据需要，用mac地址的方式配置静态IP和对应的网关，需要科学上网的指定网关到192.168.5.2（旁路由），不需要的指定网关到192.168.5.1（主路由）

测试了一下性能啊速度啊还是舒服的。Happy !

# Reorganize

目前是两个无线路由器并用，旧的Netgear上还接着NAS。最近寻思反正网线也便宜，淘宝上重新下单了5条六类线（0.5m），准备等到货之后把NAS重新接入到新的路由下，旧的路由就可以废弃了，或者丢在那里以备不时之需。
